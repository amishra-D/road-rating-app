<!DOCTYPE html>
<html>
<head>
  <title>Road Rating Firebase Integration</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <center>
    <label>Profile Name</label><input id="ProfileNameBox" type="text"><br><br>
    <label>Rating</label><input id="RatingBox" type="number" min="1" max="5"><br><br>
    <label>Review</label><input id="ReviewBox" type="text"><br><br>
    <label>Source</label><input id="SourceBox" type="text"><br><br>
    <label>Destination</label><input id="DestinationBox" type="text"><br><br>
    <hr>
    <button id="Insbtn">Insert</button>
    <button id="Selbtn">Select</button>
    <button id="Updbtn">Update</button>
    <button id="Delbtn">Delete</button>
    <hr>
    <label>Search by Source</label><input id="SearchSourceBox" type="text"><br><br>
    <label>Search by Destination</label><input id="SearchDestinationBox" type="text"><br><br>
    <button id="Searchbtn">Search</button>
    <hr>
    <div id="reviews"></div>
  </center>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, collection, addDoc, getDoc, updateDoc, deleteDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCVZ3kQQlXCqFNF8n95CnSucIILjrJKw6Q",
      authDomain: "rorad-ad3f3.firebaseapp.com",
      projectId: "rorad-ad3f3",
      storageBucket: "rorad-ad3f3.appspot.com",
      messagingSenderId: "12253847049",
      appId: "1:12253847049:web:e9184a6f1532875724a2d8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let ProfileNameBox = document.getElementById("ProfileNameBox");
    let RatingBox = document.getElementById("RatingBox");
    let ReviewBox = document.getElementById("ReviewBox");
    let SourceBox = document.getElementById("SourceBox");
    let DestinationBox = document.getElementById("DestinationBox");
    let Insbtn = document.getElementById("Insbtn");
    let Selbtn = document.getElementById("Selbtn");
    let Updbtn = document.getElementById("Updbtn");
    let Delbtn = document.getElementById("Delbtn");
    let SearchSourceBox = document.getElementById("SearchSourceBox");
    let SearchDestinationBox = document.getElementById("SearchDestinationBox");
    let Searchbtn = document.getElementById("Searchbtn");
    let reviewsDiv = document.getElementById("reviews");

    async function addReview() {
      await addDoc(collection(db, "roadratings"), {
        ProfileName: ProfileNameBox.value,
        Rating: RatingBox.value,
        Review: ReviewBox.value,
        Source: SourceBox.value,
        Destination: DestinationBox.value
      }).then(() => {
        alert("Review added successfully");
        displayAllReviews();
      }).catch((error) => {
        alert("Unsuccessful, error: " + error);
      });
    }

    async function getReviewsByProfileName() {
      reviewsDiv.innerHTML = "";
      const q = query(collection(db, "roadratings"), where("ProfileName", "==", ProfileNameBox.value));
      const querySnapshot = await getDocs(q);
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const reviewHtml = `
          <div>
            <h3>${data.ProfileName}</h3>
            <p>Rating: ${data.Rating}</p>
            <p>Review: ${data.Review}</p>
            <p>Source: ${data.Source}</p>
            <p>Destination: ${data.Destination}</p>
          </div>
          <hr>
        `;
        reviewsDiv.innerHTML += reviewHtml;
      });
    }

    async function updateReview() {
      const q = query(collection(db, "roadratings"), where("ProfileName", "==", ProfileNameBox.value));
      const querySnapshot = await getDocs(q);
      if (querySnapshot.empty) {
        alert("No reviews found to update");
        return;
      }

      const docRef = querySnapshot.docs[0].ref;
      await updateDoc(docRef, {
        Rating: RatingBox.value,
        Review: ReviewBox.value,
        Source: SourceBox.value,
        Destination: DestinationBox.value
      }).then(() => {
        alert("Review updated successfully");
        displayAllReviews();
      }).catch((error) => {
        alert("Unsuccessful, error: " + error);
      });
    }

    async function deleteReview() {
      const q = query(collection(db, "roadratings"), where("ProfileName", "==", ProfileNameBox.value));
      const querySnapshot = await getDocs(q);
      if (querySnapshot.empty) {
        alert("No reviews found to delete");
        return;
      }

      const docRef = querySnapshot.docs[0].ref;
      await deleteDoc(docRef).then(() => {
        alert("Review deleted successfully");
        displayAllReviews();
      }).catch((error) => {
        alert("Unsuccessful, error: " + error);
      });
    }

    async function searchReviews() {
      reviewsDiv.innerHTML = ""; // Clear the current content

      // Build the query based on input values
      let q = query(collection(db, "roadratings"));

      if (SearchSourceBox.value) {
        q = query(q, where("Source", "==", SearchSourceBox.value));
      }

      if (SearchDestinationBox.value) {
        q = query(q, where("Destination", "==", SearchDestinationBox.value));
      }

      const querySnapshot = await getDocs(q);
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const reviewHtml = `
          <div>
            <h3>${data.ProfileName}</h3>
            <p>Rating: ${data.Rating}</p>
            <p>Review: ${data.Review}</p>
            <p>Source: ${data.Source}</p>
            <p>Destination: ${data.Destination}</p>
          </div>
          <hr>
        `;
        reviewsDiv.innerHTML += reviewHtml;
      });
    }

    async function displayAllReviews() {
      reviewsDiv.innerHTML = ""; // Clear the current content
      const querySnapshot = await getDocs(collection(db, "roadratings"));
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const reviewHtml = `
          <div>
            <h3>${data.ProfileName}</h3>
            <p>Rating: ${data.Rating}</p>
            <p>Review: ${data.Review}</p>
            <p>Source: ${data.Source}</p>
            <p>Destination: ${data.Destination}</p>
          </div>
          <hr>
        `;
        reviewsDiv.innerHTML += reviewHtml;
      });
    }

    Insbtn.addEventListener("click", addReview);
    Selbtn.addEventListener("click", getReviewsByProfileName);
    Updbtn.addEventListener("click", updateReview);
    Delbtn.addEventListener("click", deleteReview);
    Searchbtn.addEventListener("click", searchReviews);

    // Initial display of all reviews
    displayAllReviews();
  </script>
</body>
</html>
